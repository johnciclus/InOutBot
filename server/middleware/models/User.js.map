{"version":3,"file":"User.js","sourceRoot":"","sources":["User.ts"],"names":[],"mappings":"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","sourcesContent":["import Parse from '../parse'\nimport { setUser, loadUser } from '../actions/index';\nimport Consumer from './Consumer';\nimport rp from 'request-promise';\nimport * as config from 'config';\nimport * as objectAssign from 'object-assign';\n\nconst FACEBOOK_GRAPH = config.get('FACEBOOK_GRAPH');\n\nconst User = Parse.Object.extend('User', {\n  initialize: function (attrs, options) {\n    //console.log('new user');\n    //console.log();\n    //console.log(options);\n  },\n  signUpWithFacebookData: function(data){\n    let facebookId = this.get('facebookId');\n    return this.signUp(objectAssign(data, {\n      username: facebookId.toString(),\n      password: facebookId.toString()\n    })).fail(error => {\n      console.log('Error code: ' + error.message);\n    });\n  },\n  registered: function () {\n    return new Parse.Query('User').equalTo('facebookId', this.get('facebookId')).first().fail(error => {\n      console.log('Error code: ' + error.message);\n    });\n  },\n  createConsumer: function(store, recipientId, senderId, conversationToken){\n    let consumer = new Consumer({recipientId: parseInt(recipientId), senderId: parseInt(senderId), conversationToken: conversationToken});\n    consumer.setUser(this);\n    return consumer.save().then(()=>{\n      return consumer.saveInStore(store, recipientId)\n    });\n  },\n  saveInStore: function(store, recipientId){\n    return store.dispatch(setUser(recipientId, this)).fail(error => {\n      console.log('Error code: ' + error.message);\n    });\n  }\n},  {\n  loadInStore: function(store, recipientId){\n    return store.dispatch(loadUser(recipientId)).fail(error => {\n      console.log('Error code: ' + error.message);\n    });\n  },\n  getFacebookUserData: function(facebookId, conversationToken){\n    return rp({\n      uri: FACEBOOK_GRAPH + facebookId,\n      qs: {access_token: conversationToken, fields: 'first_name,last_name,locale,timezone,gender'},\n      method: 'GET'\n    }).then( body => {\n      return JSON.parse(body);\n    }).catch(error =>{\n      console.log('error');\n      console.log(error);\n    });\n  },\n  createUser: function(store, recipientId, facebookId, conversationToken){\n    let user = new User({facebookId: parseInt(facebookId)});\n    return User.getFacebookUserData(facebookId, conversationToken).then(data => {\n      delete data.id;\n      return user.signUpWithFacebookData(data).then(() => {\n        return user.saveInStore(store, recipientId)\n      });\n    });\n  }\n});\n\nexport default User\n"]}